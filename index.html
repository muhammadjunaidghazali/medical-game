<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigating Patient Emotions: A Medical Scenario Game</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS for finer control and overrides */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-grey background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .game-container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Softer shadow */
            max-width: 900px;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 500px; /* Minimum height for better layout */
        }

        .screen {
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            flex-grow: 1; /* Allows screens to take available height */
        }

        .screen.active {
            display: flex; /* Active screen is visible */
        }

        .button-primary {
            background-color: #4f46e5; /* Indigo */
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 9999px; /* Pill-shaped button */
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
            border: none;
            cursor: pointer;
        }

        .button-primary:hover {
            background-color: #4338ca; /* Darker indigo */
            transform: translateY(-2px); /* Slight lift effect */
        }

        .option-button {
            background-color: #e0e7ff; /* Light indigo */
            color: #312e81; /* Dark indigo text */
            padding: 1rem 1.5rem;
            border-radius: 0.75rem; /* Rounded corners */
            margin-bottom: 0.75rem;
            cursor: pointer;
            text-align: left;
            transition: background-color 0.3s ease, transform 0.2s ease;
            border: 2px solid transparent; /* For highlighting */
            font-weight: 500;
        }

        .option-button:hover:not(.selected) {
            background-color: #c7d2fe; /* Lighter indigo on hover */
            transform: translateY(-2px);
        }

        .option-button.correct {
            background-color: #d1fae5; /* Green for correct */
            border-color: #10b981; /* Green border */
            color: #065f46; /* Dark green text */
        }

        .option-button.partially-correct {
            background-color: #fefcbf; /* Yellow for partially correct */
            border-color: #facc15; /* Yellow border */
            color: #854d09; /* Dark yellow text */
        }

        .option-button.incorrect {
            background-color: #fee2e2; /* Red for incorrect */
            border-color: #ef4444; /* Red border */
            color: #991b1b; /* Dark red text */
        }

        /* Disable pointer events when an option is selected */
        .options-container.answered .option-button:not(.selected) {
            pointer-events: none;
            opacity: 0.6;
        }

        .feedback-box {
            background-color: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-top: 1.5rem;
            border: 1px solid #e2e8f0;
            text-align: left;
        }

        .feedback-box h3 {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            background-color: #e2e8f0;
            border-radius: 0.5rem;
            height: 8px;
            width: 100%;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            background-color: #4f46e5;
            height: 100%;
            width: 0%;
            border-radius: 0.5rem;
            transition: width 0.5s ease-in-out;
        }

        /* Input field styling */
        .name-input {
            padding: 0.75rem 1.25rem;
            border: 1px solid #cbd5e1; /* Slate-300 */
            border-radius: 0.75rem;
            width: 80%;
            max-width: 300px;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            color: #334155; /* Slate-700 */
        }
        .name-input::placeholder {
            color: #94a3b8; /* Slate-400 */
        }
        .name-input:focus {
            outline: none;
            border-color: #6366f1; /* Indigo-500 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .error-message {
            color: #ef4444; /* Red-500 */
            font-size: 0.875rem;
            margin-top: -1rem;
            margin-bottom: 1rem;
        }

        /* Scoreboard styling */
        .scoreboard {
            width: 100%;
            max-width: 400px;
            margin-top: 2rem;
            background-color: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        .scoreboard-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #334155;
            margin-bottom: 1rem;
        }
        .scoreboard-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #e2e8f0;
            font-size: 1.125rem;
            color: #475569;
        }
        .scoreboard-item:last-child {
            border-bottom: none;
        }
        .scoreboard-item .name {
            font-weight: 600;
        }
        .scoreboard-item .score {
            color: #4f46e5;
            font-weight: 700;
        }


        /* Responsive adjustments */
        @media (min-width: 640px) {
            .game-container {
                padding: 2rem;
            }
        }
    </style>
</head>
<body class="selection:bg-indigo-300 selection:text-indigo-900">
    <div class="game-container flex flex-col items-center justify-between p-4 sm:p-8">

        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <h1 class="text-4xl sm:text-5xl font-bold text-gray-800 mb-6 leading-tight">Navigating Patient Emotions: A Medical Scenario Game</h1>
            <div class="mb-8 w-32 h-32 flex items-center justify-center bg-indigo-100 rounded-full shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#4f46e5" class="w-20 h-20">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.25 2.25 0 0019.5 18.75V10.5m-11.69 5.69L7.75 21A2.25 2.25 0 015.25 18.75V10.5m10.38-4.5a1.125 1.125 0 011.125 1.125v1.5c0 .621.504 1.125 1.125 1.125H21h-6.182a1.125 1.125 0 00-1.125 1.125m-11.69-5.69A1.125 1.125 0 016.75 7.5v1.5c0 .621-.504 1.125-1.125 1.125H3h6.182a1.125 1.125 0 011.125 1.125m9.75-9.75a1.5 1.5 0 000 3m-9.75-3a1.5 1.5 0 000 3M9 15.375v-3.375c0-.621.504-1.125 1.125-1.125h.875c.621 0 1.125.504 1.125 1.125v3.375m7.5-3.375c0-.621.504-1.125 1.125-1.125h.875c.621 0 1.125.504 1.125 1.125v3.375m-9.75 3.375v-3.375c0-.621.504-1.125 1.125-1.125h.875c.621 0 1.125.504 1.125 1.125v3.375" />
                </svg>
            </div>
            <p class="text-lg text-gray-600 mb-6 max-w-xl">
                As healthcare professionals, understanding and responding to patients' psychological reactions is crucial. This game will present you with medical scenarios and challenge you to choose the most empathetic and effective responses.
            </p>
            <input type="text" id="player-name-input" class="name-input" placeholder="Enter your name">
            <p id="name-error" class="error-message hidden">Please enter your name to start the game.</p>
            <button id="start-game-btn" class="button-primary">Start Game</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="w-full flex justify-between items-center mb-4">
                <span id="score-display" class="text-xl font-semibold text-gray-700">Score: 0</span>
                <span id="scenario-progress" class="text-lg text-gray-500">Scenario 1 of 5</span>
            </div>
            <div class="progress-bar mb-6">
                <div id="progress-fill" class="progress-fill"></div>
            </div>

            <div class="scenario-card bg-white p-6 rounded-xl shadow-md border border-gray-200 w-full mb-6">
                <img id="scenario-image" class="w-24 h-24 mx-auto mb-4 rounded-lg object-cover bg-gray-100 flex items-center justify-center text-gray-400" src="https://placehold.co/96x96/e0e7ff/4f46e5?text=Scenario" alt="Scenario Placeholder">
                <p id="scenario-text" class="text-lg text-gray-800 leading-relaxed mb-6"></p>
            </div>

            <div id="options-container" class="options-container w-full grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Options will be dynamically loaded here -->
            </div>

            <div id="feedback-container" class="feedback-box hidden mt-6 w-full max-w-lg">
                <h3 id="feedback-heading" class="text-xl font-semibold text-gray-800 mb-2"></h3>
                <p id="feedback-text" class="text-gray-700"></p>
            </div>

            <button id="next-scenario-btn" class="button-primary mt-8 hidden">Next Scenario</button>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <h2 class="text-4xl font-bold text-gray-800 mb-6">Game Over!</h2>
            <p class="text-2xl text-gray-700 mb-4">Your final score: <span id="final-score" class="font-bold text-indigo-600">0</span></p>
            <div class="scoreboard">
                <h3 class="scoreboard-title">Top Scores</h3>
                <div id="scoreboard-list">
                    <!-- Scoreboard items will be loaded here -->
                </div>
            </div>
            <p id="performance-summary" class="text-lg text-gray-600 mb-8 max-w-xl"></p>
            <button id="play-again-btn" class="button-primary">Play Again</button>
        </div>

    </div>

    <script>
        // Game state variables
        let currentScenarioIndex = 0;
        let score = 0;
        let isAnswered = false; // To prevent multiple clicks on options
        let playerName = ''; // Variable to store player's name
        const scoreboard = []; // Array to store scores for the current session

        // DOM element references
        const welcomeScreen = document.getElementById('welcome-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const nextScenarioBtn = document.getElementById('next-scenario-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const scoreDisplay = document.getElementById('score-display');
        const scenarioProgress = document.getElementById('scenario-progress');
        const progressBarFill = document.getElementById('progress-fill');
        const scenarioImage = document.getElementById('scenario-image');
        const scenarioText = document.getElementById('scenario-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackHeading = document.getElementById('feedback-heading');
        const feedbackText = document.getElementById('feedback-text');
        const finalScoreDisplay = document.getElementById('final-score');
        const performanceSummary = document.getElementById('performance-summary');
        const playerNameInput = document.getElementById('player-name-input'); // New: Player name input
        const nameError = document.getElementById('name-error'); // New: Name error message
        const scoreboardList = document.getElementById('scoreboard-list'); // New: Scoreboard list container

        // Define game scenarios
        // Each scenario includes text, an image placeholder, the core psychological reaction,
        // a list of response options, the index of the best option, and detailed feedback.
        const scenarios = [
            {
                scenarioText: "Mrs. Fatima, a 70-year-old patient, clutches her chest tightly, her breathing is shallow and rapid. When you ask how she's feeling, she whispers, 'I... I can't breathe... I'm so scared. What's happening to me?'",
                imagePlaceholder: "https://placehold.co/96x96/e0e7ff/4f46e5?text=Anxiety",
                reaction: "Anxiety/Fear",
                options: [
                    "\"Don't worry, you'll be fine. Just breathe normally.\"",
                    "\"I understand you're scared, Mrs. Fatima. Let's try some slow, deep breaths together. I'm here with you.\"",
                    "\"We need to run some tests. Please calm down.\"",
                    "\"Are you always this dramatic when you come to the hospital?\""
                ],
                correctOptionIndex: 1, // Index of the most appropriate response
                feedback: {
                    correct: {
                        heading: "Correct! Excellent Empathy.",
                        text: "Mrs. Fatima is experiencing acute anxiety and fear. Your response validates her feelings, offers a calming technique, and reassures her with your presence. This builds trust and helps her regain control."
                    },
                    partiallyCorrect: {
                        heading: "Partially Correct.",
                        text: "While trying to reassure, simply saying 'Don't worry' can dismiss her feelings. The patient is exhibiting high levels of anxiety and fear. It's better to acknowledge her fear and provide concrete coping strategies."
                    },
                    incorrect: {
                        heading: "Incorrect.",
                        text: "Telling a patient to 'calm down' or questioning their behavior in this manner invalidates their experience and can escalate their distress. The patient is exhibiting high levels of anxiety and fear. Always approach with empathy and focus on active listening and support."
                    }
                }
            },
            {
                scenarioText: "Mr. Sohail, a 55-year-old recently diagnosed with Type 2 Diabetes, waves his hand dismissively. 'Diabetes? No, no, that's not me. I feel fine. My blood sugar was probably just off that day.'",
                imagePlaceholder: "https://placehold.co/96x96/ffe4e6/ef4444?text=Denial",
                reaction: "Denial",
                options: [
                    "\"Mr. Sohail, you must accept your diagnosis. It's serious.\"",
                    "\"I understand this is a lot to take in, Mr. Sohail. Many people feel overwhelmed initially. Let's talk about what this diagnosis means when you're ready.\"",
                    "\"If you don't take this seriously, you'll have severe complications.\""
                ],
                correctOptionIndex: 1,
                feedback: {
                    correct: {
                        heading: "Correct! Empathetic and Patient.",
                        text: "Mr. Sohail is in denial, a common reaction to difficult diagnoses. Your response acknowledges his potential overwhelm, shows empathy, and offers support without forcing acceptance immediately. This opens a path for future education and acceptance."
                    },
                    partiallyCorrect: {
                        heading: "Partially Correct.",
                        text: "While acceptance is important, a direct demand can make the patient more resistant. The patient is exhibiting denial. Focus on validating their feelings and offering support and information when they are ready to receive it."
                    },
                    incorrect: {
                        heading: "Incorrect.",
                        text: "Using threats or guilt trips is counterproductive and can damage the therapeutic relationship. The patient is exhibiting denial. Instead, provide understanding and a safe space for them to process the information at their own pace."
                    }
                }
            },
            {
                scenarioText: "After waiting for over an hour, Ms. Ayesha, a young adult, storms up to the reception desk, her voice rising. 'This is ridiculous! I've been here forever! Do you even care that I have other things to do?!'",
                imagePlaceholder: "https://placehold.co/96x96/fffbeb/facc15?text=Anger",
                reaction: "Anger/Frustration",
                options: [
                    "\"Please lower your voice, Ms. Ayesha, you're disturbing other patients.\"",
                    "\"I apologize for the wait, Ms. Ayesha. I can see how frustrating this must be. Let me check with the doctor's office for an updated estimate on your wait time.\"",
                    "\"Everyone has to wait. You're not special.\""
                ],
                correctOptionIndex: 1,
                feedback: {
                    correct: {
                        heading: "Correct! De-escalation through Empathy.",
                        text: "Ms. Ayesha is expressing anger and frustration due to the wait. Your response validates her feelings ('I can see how frustrating this must be'), apologizes for the inconvenience, and offers a concrete action to resolve the issue. This often de-escalates the situation."
                    },
                    partiallyCorrect: {
                        heading: "Partially Correct.",
                        text: "While asking a patient to lower their voice might be necessary for the environment, it doesn't address the underlying frustration. The patient is exhibiting anger and frustration. Focus on acknowledging their feelings before setting boundaries."
                    },
                    incorrect: {
                        heading: "Incorrect.",
                        text: "Dismissing a patient's feelings or being sarcastic will only escalate their anger and damage trust. The patient is exhibiting anger and frustration. Always respond with empathy and a commitment to address their concerns respectfully."
                    }
                }
            },
            {
                scenarioText: "Mr. Rizwan, a middle-aged man, just received difficult news about his prognosis. He sits slumped in his chair, avoiding eye contact, and his eyes appear watery. He says softly, 'I don't know what to do... this is too much.'",
                imagePlaceholder: "https://placehold.co/96x96/e6f6ff/60a5fa?text=Sadness",
                reaction: "Sadness/Grief/Overwhelm",
                options: [
                    "\"Let me give you some pamphlets to read about your condition.\"",
                    "\"I'm sorry you're going through this. Take your time. Is there anything at all I can do for you right now, or would you prefer some quiet space?\"",
                    "\"You need to stay strong for your family, Mr. Rizwan.\""
                ],
                correctOptionIndex: 1,
                feedback: {
                    correct: {
                        heading: "Correct! Compassionate Support.",
                        text: "Mr. Rizwan is experiencing sadness and overwhelm. Your response offers genuine empathy, respects his need for time, and allows him to direct what kind of support he needs (or doesn't need) at that moment. This is crucial for grief processing."
                    },
                    partiallyCorrect: {
                        heading: "Partially Correct.",
                        text: "While information is important, Mr. Rizwan is clearly overwhelmed and emotionally distressed. The patient is exhibiting sadness and overwhelm. This is not the right time for new information; prioritize emotional support first."
                    },
                    incorrect: {
                        heading: "Incorrect.",
                        text: "Telling someone to 'stay strong' can invalidate their feelings and add pressure during a vulnerable time. The patient is exhibiting sadness and overwhelm. Focus on acknowledging their pain and offering unconditional support."
                    }
                }
            },
            {
                scenarioText: "A young adult patient, Ms. Sara, is given complex instructions for managing their new chronic condition, including medication schedules, dietary restrictions, and follow-up appointments. They stare blankly, then say, 'So... what was that about the blue pill... and was it no sugar or just less sugar?'",
                imagePlaceholder: "https://placehold.co/96x96/f1f5f9/64748b?text=Overload",
                reaction: "Information Overload",
                options: [
                    "\"I just explained it. Weren't you listening?\"",
                    "\"It sounds like a lot of information, and it is! Let's break it down. What's the most important thing you remember, and what questions do you have about the rest?\"",
                    "\"The instructions are all in the pamphlet. Read it carefully.\"",
                    "\"It's simple. Take the blue pill twice a day, no sugar at all.\""
                ],
                correctOptionIndex: 1,
                feedback: {
                    correct: {
                        heading: "Correct! Clear and Collaborative.",
                        text: "Ms. Sara is experiencing information overload. Your response acknowledges the volume of information, offers to break it down, and encourages them to identify what they've retained and where their specific questions lie. This is a patient-centered approach to education."
                    },
                    partiallyCorrect: {
                        heading: "Partially Correct.",
                        text: "While providing simple instructions might seem helpful, it doesn't address the underlying issue of information overload or check for understanding. The patient is exhibiting signs of information overload. Acknowledge this and break down information into manageable chunks."
                    },
                    incorrect: {
                        heading: "Incorrect.",
                        text: "Accusing the patient of not listening is disrespectful and unhelpful. Simply referring to a pamphlet without further interaction is also dismissive. The patient is exhibiting information overload. Always re-explain and check for understanding patiently."
                    }
                }
            }
        ];

        // Initialize game on window load
        window.onload = initGame;

        /**
         * Initializes the game by setting initial state and displaying the welcome screen.
         */
        function initGame() {
            currentScenarioIndex = 0;
            score = 0;
            isAnswered = false;
            playerName = ''; // Clear player name on new game
            playerNameInput.value = ''; // Clear input field
            nameError.classList.add('hidden'); // Hide error message
            scoreDisplay.textContent = `Score: ${score}`;
            updateProgressBar();

            // Hide all screens and show welcome screen
            welcomeScreen.classList.add('active');
            gameScreen.classList.remove('active');
            resultsScreen.classList.remove('active');

            // Hide feedback and next button initially
            feedbackContainer.classList.add('hidden');
            nextScenarioBtn.classList.add('hidden');
            optionsContainer.classList.remove('answered'); // Reset options container state

            // Clear scoreboard display
            scoreboardList.innerHTML = '';
        }

        /**
         * Starts the game, transitioning from the welcome screen to the first scenario.
         */
        function startGame() {
            // Get player name and validate
            const name = playerNameInput.value.trim();
            if (name === '') {
                nameError.classList.remove('hidden');
                return;
            }
            playerName = name;
            nameError.classList.add('hidden'); // Hide error if name is entered

            welcomeScreen.classList.remove('active');
            gameScreen.classList.add('active');
            loadScenario();
        }

        /**
         * Loads and displays the current scenario's information.
         */
        function loadScenario() {
            // Reset state for new scenario
            isAnswered = false;
            feedbackContainer.classList.add('hidden');
            nextScenarioBtn.classList.add('hidden');
            optionsContainer.classList.remove('answered');

            const scenario = scenarios[currentScenarioIndex];

            // Update scenario text and image
            scenarioText.textContent = scenario.scenarioText;
            scenarioImage.src = scenario.imagePlaceholder;
            scenarioImage.alt = `Icon for ${scenario.reaction}`; // Update alt text

            // Update progress indicator
            scenarioProgress.textContent = `Scenario ${currentScenarioIndex + 1} of ${scenarios.length}`;
            updateProgressBar();

            // Clear previous options
            optionsContainer.innerHTML = '';

            // Dynamically create option buttons
            scenario.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-button', 'block', 'w-full', 'hover:shadow-md');
                button.dataset.index = index; // Store index for checking answer
                button.addEventListener('click', () => checkAnswer(index));
                optionsContainer.appendChild(button);
            });
        }

        /**
         * Checks the player's selected answer, provides feedback, and updates score.
         * @param {number} selectedIndex The index of the chosen option.
         */
        function checkAnswer(selectedIndex) {
            if (isAnswered) return; // Prevent multiple answers for the same scenario
            isAnswered = true;

            const scenario = scenarios[currentScenarioIndex];
            const correctIndex = scenario.correctOptionIndex;
            const chosenButton = optionsContainer.children[selectedIndex];

            // Add 'selected' class to prevent hover effects and indicate chosen option
            chosenButton.classList.add('selected');

            // Apply styling based on correctness
            if (selectedIndex === correctIndex) {
                chosenButton.classList.add('correct');
                score += 10;
                feedbackHeading.textContent = scenario.feedback.correct.heading;
                feedbackText.textContent = scenario.feedback.correct.text;
            } else if (scenario.feedback.partiallyCorrect && selectedIndex === scenario.feedback.partiallyCorrectIndex) {
                 // If there's a specific 'partially correct' option defined in the scenario.
                chosenButton.classList.add('partially-correct');
                score += 5;
                feedbackHeading.textContent = scenario.feedback.partiallyCorrect.heading;
                feedbackText.textContent = scenario.feedback.partiallyCorrect.text;
            }
            else {
                chosenButton.classList.add('incorrect');
                score += 0; // No points for incorrect answers
                feedbackHeading.textContent = scenario.feedback.incorrect.heading;
                feedbackText.textContent = scenario.feedback.incorrect.text;

                // Highlight the correct answer if an incorrect one was chosen
                const correctButton = optionsContainer.children[correctIndex];
                if (correctButton) { // Ensure correctButton exists
                    correctButton.classList.add('correct');
                    correctButton.classList.remove('opacity-60', 'pointer-events-none'); // Make correct visible
                }
            }

            scoreDisplay.textContent = `Score: ${score}`;
            feedbackContainer.classList.remove('hidden');
            nextScenarioBtn.classList.remove('hidden');
            optionsContainer.classList.add('answered'); // Disable further clicks on options
        }

        /**
         * Advances to the next scenario or ends the game if all scenarios are completed.
         */
        function nextScenario() {
            currentScenarioIndex++;
            if (currentScenarioIndex < scenarios.length) {
                loadScenario();
            } else {
                endGame();
            }
        }

        /**
         * Ends the game and displays the results screen.
         */
        function endGame() {
            gameScreen.classList.remove('active');
            resultsScreen.classList.add('active');
            finalScoreDisplay.textContent = score;

            // Add current player's score to the scoreboard
            scoreboard.push({ name: playerName, score: score });
            // Sort scoreboard by score in descending order
            scoreboard.sort((a, b) => b.score - a.score);

            // Display scoreboard
            displayScoreboard();

            // Determine performance summary based on score
            let summary = "";
            const maxScore = scenarios.length * 10;
            const percentage = (score / maxScore) * 100;

            if (percentage >= 90) {
                summary = "Excellent Job, Healthcare Hero! You demonstrated exceptional empathy and understanding of psychological reactions.";
            } else if (percentage >= 70) {
                summary = "Great Work! You have a solid grasp of patient emotions. Keep practicing to master all reactions.";
            } else if (percentage >= 50) {
                summary = "Good Effort! You're on your way to becoming an empathetic healthcare professional. Review the feedback to improve.";
            } else {
                summary = "Keep Practicing! Understanding patient emotions is a key skill. Review the scenarios and try again.";
            }
            performanceSummary.textContent = summary;
        }

        /**
         * Updates the progress bar based on the current scenario.
         */
        function updateProgressBar() {
            const progressPercentage = ((currentScenarioIndex + 1) / scenarios.length) * 100;
            progressBarFill.style.width = `${progressPercentage}%`;
        }

        /**
         * Displays the current scoreboard on the results screen.
         */
        function displayScoreboard() {
            scoreboardList.innerHTML = ''; // Clear previous scoreboard
            // Display top 5 scores, or all if less than 5
            const scoresToDisplay = scoreboard.slice(0, 5);

            if (scoresToDisplay.length === 0) {
                const noScoresMsg = document.createElement('p');
                noScoresMsg.textContent = "No scores yet. Be the first!";
                noScoresMsg.classList.add('text-gray-500', 'py-4');
                scoreboardList.appendChild(noScoresMsg);
                return;
            }

            scoresToDisplay.forEach((entry, index) => {
                const scoreItem = document.createElement('div');
                scoreItem.classList.add('scoreboard-item');
                scoreItem.innerHTML = `
                    <span class="name">${index + 1}. ${entry.name}</span>
                    <span class="score">${entry.score} points</span>
                `;
                scoreboardList.appendChild(scoreItem);
            });
        }


        // Event Listeners
        startGameBtn.addEventListener('click', startGame);
        nextScenarioBtn.addEventListener('click', nextScenario);
        playAgainBtn.addEventListener('click', initGame); // initGame will reset and show welcome

    </script>
</body>
</html>
